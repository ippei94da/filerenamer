#! /usr/bin/env ruby
# coding: utf-8

require "pp"
gem "builtinextension"
require "string/escapezsh.rb"
require "filerenamer.rb"
#require "filerenamer/commander.rb"
#require "filerenamer/optionparser.rb"

HASH_COMMAND = "sha256sum"
op = FileRenamer::OptionParser.new
op.parse!(ARGV)

fr = FileRenamer::Commander.new(op.options, ARGV)
fr.execute do |filename|
  extname = File.extname filename
  oldname = filename.escape_zsh
  basename = `#{HASH_COMMAND} #{oldname}`.sub(/ *#{oldname}$/, '').chomp
  newname = basename + extname
  newname
end
